<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrations Admin - Utah Mixed Epic</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .admin-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .admin-header h2 {
        margin: 0;
      }

      .btn-group {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 10px 20px;
        background-color: #2c5f8d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }

      .btn:hover {
        background-color: #1e4356;
      }

      .btn-danger {
        background-color: #d32f2f;
      }

      .btn-danger:hover {
        background-color: #b71c1c;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-card h3 {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 14px;
        text-transform: uppercase;
      }

      .stat-card .number {
        font-size: 32px;
        font-weight: bold;
        color: #2c5f8d;
      }

      .registrations-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }

      .registrations-table thead {
        background-color: #2c5f8d;
        color: white;
      }

      .registrations-table th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
      }

      .registrations-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #eee;
      }

      .registrations-table tbody tr:hover {
        background-color: #f9f9f9;
      }

      .action-btn {
        padding: 6px 12px;
        font-size: 12px;
        margin-right: 5px;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }

      .empty-state h3 {
        margin-bottom: 10px;
      }

      .export-info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }

      .export-info strong {
        color: #1976d2;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <div class="logo">
          <h1>Utah Mixed Epic</h1>
        </div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="courses.html">Courses</a></li>
          <li><a href="registration.html">Register</a></li>
          <li><a href="more-info.html">More Info</a></li>
        </ul>
      </div>
    </nav>

    <!-- Admin Section -->
    <section class="page-header">
      <h1>Registration Admin</h1>
      <p>View and manage all event registrations</p>
    </section>

    <div class="admin-container">
      <div class="export-info">
        <strong>üíæ Data Storage:</strong> All registrations are saved in your
        browser's local storage. Use the download button to export as CSV for
        backup.
      </div>

      <div class="admin-header">
        <h2>All Registrations</h2>
        <div class="btn-group">
          <button class="btn" onclick="exportToCSV()">üì• Download CSV</button>
          <button class="btn btn-danger" onclick="clearAllRegistrations()">
            üóëÔ∏è Clear All
          </button>
        </div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <h3>Total Registrations</h3>
          <div class="number" id="totalCount">0</div>
        </div>
        <div class="stat-card">
          <h3>Last Registration</h3>
          <div class="number" id="lastReg">-</div>
        </div>
      </div>

      <div id="registrationsContainer"></div>
    </div>

    <script src="script.js"></script>
    <script>
      // Display all registrations
      function displayRegistrations() {
        const registrations = getAllRegistrations();
        const container = document.getElementById("registrationsContainer");

        // Update stats
        document.getElementById("totalCount").textContent =
          registrations.length;

        if (registrations.length > 0) {
          const lastDate = new Date(
            registrations[registrations.length - 1].timestamp,
          );
          document.getElementById("lastReg").textContent =
            lastDate.toLocaleDateString();
        }

        if (registrations.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>No registrations yet</h3>
              <p>Registrations will appear here once cyclists submit the registration form.</p>
              <a href="registration.html" style="color: #2c5f8d; text-decoration: none;">Go to Registration ‚Üí</a>
            </div>
          `;
          return;
        }

        // Create table
        let html = `
          <table class="registrations-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Course</th>
                <th>Age</th>
                <th>Emergency Contact</th>
                <th>Date Registered</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
        `;

        registrations.forEach((reg) => {
          const date = new Date(reg.timestamp);
          const formattedDate =
            date.toLocaleDateString() + " " + date.toLocaleTimeString();

          html += `
            <tr>
              <td>${reg.firstName} ${reg.lastName}</td>
              <td>${reg.email}</td>
              <td>${reg.phone}</td>
              <td>${reg.course}</td>
              <td>${reg.age}</td>
              <td>${reg.emergencyContact}</td>
              <td>${formattedDate}</td>
              <td>
                <button class="btn action-btn btn-danger" onclick="deleteReg(${reg.id})">Delete</button>
              </td>
            </tr>
          `;
        });

        html += `
            </tbody>
          </table>
        `;

        container.innerHTML = html;
      }

      // Delete a single registration
      function deleteReg(id) {
        if (confirm("Are you sure you want to delete this registration?")) {
          deleteRegistration(id);
          displayRegistrations();
        }
      }

      // Clear all registrations
      function clearAllRegistrations() {
        if (
          confirm(
            "Are you sure? This will delete ALL registrations. This cannot be undone!",
          )
        ) {
          localStorage.removeItem("umeRegistrations");
          displayRegistrations();
          alert("All registrations have been cleared.");
        }
      }

      // Export registrations to CSV
      function exportToCSV() {
        const registrations = getAllRegistrations();

        if (registrations.length === 0) {
          alert("No registrations to export.");
          return;
        }

        // Create CSV header
        const headers = [
          "First Name",
          "Last Name",
          "Email",
          "Phone",
          "Age",
          "Course",
          "Emergency Contact",
          "Emergency Phone",
          "Date Registered",
        ];

        // Create CSV rows
        let csvContent = headers.join(",") + "\n";

        registrations.forEach((reg) => {
          const date = new Date(reg.timestamp).toLocaleString();
          const row = [
            reg.firstName,
            reg.lastName,
            reg.email,
            reg.phone,
            reg.age,
            reg.course,
            reg.emergencyContact,
            reg.emergencyPhone,
            date,
          ];

          // Wrap fields in quotes to handle commas
          csvContent += row.map((field) => `"${field}"`).join(",") + "\n";
        });

        // Create blob and download
        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);

        link.setAttribute("href", url);
        link.setAttribute(
          "download",
          `ume-registrations-${new Date().toISOString().split("T")[0]}.csv`,
        );
        link.style.visibility = "hidden";

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        displayRegistrations();

        // Refresh every 5 seconds to show real-time updates
        setInterval(displayRegistrations, 5000);
      });
    </script>
  </body>
</html>
